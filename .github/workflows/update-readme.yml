name: Update README Daily with Live Stats

on:
  schedule:
    # Runs every day at 9 AM UTC
    - cron: '0 9 * * *'
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Fetch GitHub Stats and Generate README
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          node << 'SCRIPT'
          const https = require('https');
          const fs = require('fs');
          
          function fetchGitHub(url) {
            return new Promise((resolve, reject) => {
              const options = {
                hostname: 'api.github.com',
                path: url,
                method: 'GET',
                headers: {
                  'User-Agent': 'GitHub-Action',
                  'Authorization': `token ${process.env.GITHUB_TOKEN}`
                }
              };
              
              https.request(options, (res) => {
                let data = '';
                res.on('data', chunk => data += chunk);
                res.on('end', () => resolve(JSON.parse(data)));
              }).on('error', reject).end();
            });
          }
          
          async function generateReadme() {
            try {
              // Fetch user stats
              const user = await fetchGitHub('/users/DNYFTETCH');
              const repos = await fetchGitHub('/users/DNYFTETCH/repos?per_page=100&sort=stars&direction=desc');
              
              // Calculate stats
              const totalStars = repos.reduce((sum, repo) => sum + repo.stargazers_count, 0);
              const topRepos = repos.slice(0, 3);
              const languages = {};
              repos.forEach(repo => {
                if (repo.language) {
                  languages[repo.language] = (languages[repo.language] || 0) + 1;
                }
              });
              
              const now = new Date();
              const timestamp = now.toLocaleString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
              });
              
              const readme = `# üëã Hey there, I'm _DNYF_

Welcome to my GitHub! üöÄ  
I'm passionate about **cybersecurity, app development, and digital innovation**.  
I like keeping things **minimalist, modern, and rugged**‚Äîwhether it's code, design, or branding.

---

## üìä Live GitHub Stats (Updated Daily)
| Metric | Count |
|--------|-------|
| üì¶ Public Repositories | **${user.public_repos}** |
| üë• Followers | **${user.followers}** |
| ‚≠ê Total Stars | **${totalStars}** |
| üìç Public Gists | **${user.public_gists}** |

**Last Updated:** _${timestamp}_

---

## üî• Top Projects

${topRepos.map((repo, i) => `
### ${i + 1}. [${repo.name}](${repo.html_url})
_${repo.description || 'No description'}_
- **Language:** ${repo.language || 'Unknown'}
- **Stars:** ‚≠ê ${repo.stargazers_count}
- **Forks:** üç¥ ${repo.forks_count}
`).join('\n')}

---

## üíª Languages & Tech Stack
\`\`\`
${Object.entries(languages)
  .sort((a, b) => b[1] - a[1])
  .map(([lang, count]) => \`\${lang}: \${count} repo\${count > 1 ? 's' : ''}\`)
  .join('\n')}
\`\`\`

### Primary Tech
![JavaScript](https://img.shields.io/badge/Code-JavaScript-yellow?logo=javascript&style=flat-square)
![Python](https://img.shields.io/badge/Code-Python-blue?logo=python&style=flat-square)
![Node.js](https://img.shields.io/badge/Runtime-Node.js-green?logo=node.js&style=flat-square)
![Linux](https://img.shields.io/badge/OS-Linux-black?logo=linux&style=flat-square)
![Git](https://img.shields.io/badge/Tool-Git-orange?logo=git&style=flat-square)

---

## üìà GitHub Analytics
![DNYF's GitHub stats](https://github-readme-stats.vercel.app/api?username=DNYFTETCH&show_icons=true&theme=radical&hide_border=true)

![Top Languages](https://github-readme-stats.vercel.app/api/top-langs/?username=DNYFTETCH&layout=compact&theme=radical&hide_border=true)

---

## üåç Let's Connect
- **GitHub:** [@DNYFTETCH](https://github.com/DNYFTETCH)
- **Portfolio:** [Coming Soon](https://dnyf.dev)
- **Email:** Open for collaborations

---

## ‚ö° Philosophy
_"Stay rugged. Stay secure. Keep building."_

Building minimalist solutions that actually matter. Security-first mindset. Always learning.

---

**ü§ñ This README is auto-updated daily using GitHub Actions**
`;

              fs.writeFileSync('README.md', readme);
              console.log('‚úÖ README generated successfully!');
            } catch (error) {
              console.error('‚ùå Error:', error);
              process.exit(1);
            }
          }
          
          generateReadme();
          SCRIPT

      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Bot"
          git add README.md
          if git diff --quiet --cached; then
            echo "No changes to commit"
          else
            git commit -m "ü§ñ chore: auto-update README with live GitHub stats"
            git push
          fi
